import{_ as T,F as Q,o as z,ak as B,G as u,H as v,I as i,R as n,J as o,P as r,al as d,L as f,M as g,O as p,S as k,T as C,s as U,am as _,an as q,ao as $,aC as y,aD as E,K as b,ap as w,aq as M,ar as P,as as A}from"./index.72e2c796.js";import{Q as V}from"./QBtnGroup.b69c6302.js";import{Q as R}from"./QDate.3c6f7457.js";import{Q as Y}from"./QTime.aa351711.js";import{Q as N}from"./QItem.e6aea75d.js";import{Q as F}from"./QList.726589ab.js";import{Q as L}from"./QPage.3fcf59c0.js";import{u as O,C as j}from"./store_goals.88e10141.js";import{u as H,Q as K}from"./QSpinnerFacebook.2ae7f491.js";import{d as G}from"./date.a6efd5a0.js";import{u as W}from"./store_successes.ff3b616b.js";import{u as D}from"./store_settings.a1abbadf.js";import"./TouchPan.b1075a9c.js";import"./selection.e44b2370.js";const J=Q({name:"UnscheduledGoalsPage",data(){return{changeAlertTimeDialog:!1,coinsStorageKey:"coins",enableNotificationsBeta:!1,days:[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}]}},created(){this.showLoading()},beforeMount(){this.settingsStore=D(),this.settingsStore.initialize(),this.goalsStore=O(),this.goalsStore.initialize(),this.successesStore=W(),this.successesStore.initialize(),this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle()),this.$emit("refresh-header"),this.processing=!1,this.settingsStore.termsUpToDate()||this.$router.push("terms")},setup(){const e=H();let t;return z(()=>{t!==void 0&&(clearTimeout(t),e.loading.hide())}),{showLoading(){e.loading.show({spinner:K,spinnerColor:"white",spinnerSize:140,backgroundColor:"black",message:"Loading your unscheduled goals... Please wait!",messageColor:"white"}),t=setTimeout(()=>{e.loading.hide(),t=void 0},500)}}},computed:{...B(D,["useBigButtons","goalsSortStyle"]),buttonClass(){return this.useBigButtons?"bigBtn":""},sortStyle(){return this.goalsSortStyle},buttonText(){return`Sort: ${this.sortStyle}`}},methods:{saveUnscheduledGoals(){this.$q.notify("Goals saved!"),this.goalsStore.saveUnscheduledGoals()},viewGoals(){this.$router.push("goals")},completeGoal(e){if(e.goal.length<1){this.$q.notify("Enter a title first!");return}if(e.stepsEnabled){for(var t=!0,a=0;a<e.stepsSize;a++)e.steps[a].value||(t=!1);if(!t){this.$q.notify("Complete all steps first!");return}}this.$q.dialog({title:"Confirm",message:'Confirm completion of goal: "'+e.goal+'"',cancel:!0,persistent:!0}).onOk(()=>{var S=this.goalsStore.goalReward(e);this.$q.notify("Rewarded "+S+" coins for completion!"),this.settingsStore.coins=this.settingsStore.coins+S,this.settingsStore.totalCoins=this.settingsStore.totalCoins+S;var h=Object.assign({},e);h.alertTime=null,h.date=this.getDateWithTime(),h.timeTieBreaker=this.getTime(),h.type="goal",this.successesStore.addEntry(h),this.$q.notify('Goal complete! "'+h.goal+'"'),this.settingsStore.saveCoins(),this.goalsStore.removeUnscheduledGoal(e.id),this.$emit("refresh-header")})},moveStep(e,t,a){t<0||t>=e.steps.length||a!==-1&&a!==1||(a===-1&&t>0?[e.steps[t],e.steps[t-1]]=[e.steps[t-1],e.steps[t]]:a===1&&t<e.steps.length-1&&([e.steps[t],e.steps[t+1]]=[e.steps[t+1],e.steps[t]]),this.saveGoals())},removeStep(e,t){if(!(t<0||t>=e.steps.length)){var a='Are you sure you want to delete the step: "'+e.steps[t].label+'"?';e.steps[t].length<1&&(a="Are you sure you want to delete the unnamed step?"),this.$q.dialog({title:"Confirm",message:a,cancel:!0,persistent:!0}).onOk(()=>{e.steps[t].length<1?this.$q.notify("Step deleted"):this.$q.notify('Step deleted: "'+e.steps[t].label+'"'),e.steps.splice(t,1),e.stepsSize--,this.saveUnscheduledGoals()})}},toggleSteps(e){e.steps?(e.stepsEnabled=!e.stepsEnabled,e.stepsEnabled&&e.stepsSize==0&&this.addSteps(e)):(e.stepsEnabled=!0,e.steps=[],e.stepsSize=0,this.addSteps(e)),this.saveUnscheduledGoals()},toggleGoalsSortStyle(){this.settingsStore.toggleGoalsSortStyle(),this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle())},findMatchingInput(){return new Promise(e=>{this.$nextTick(()=>{this.$nextTick(()=>{for(const t in this.$refs.stepDescRef){const a=this.$refs.stepDescRef[t];if(a.modelValue==this.selectedStep.label){e(a);return}}e(null)})})})},handleStepInput(e){if(e.key){if(e.key=="Enter"){if(this.processing)return;this.processing=!0,this.addSteps(this.selectedGoal,this.selectedStepIndex+1),this.findMatchingInput().then(t=>{t&&(e.preventDefault(),e.stopPropagation(),this.selectedStep.label="",t.focus(),this.saveUnscheduledGoals()),this.processing=!1})}else if(e.key=="Backspace"&&this.selectedStep.label==""){if(this.processing)return;if(e.preventDefault(),e.stopPropagation(),this.selectedGoal.stepsSize==0){this.selectedGoal.stepsEnabled=!1,this.selectedStep=null,this.saveGoals();return}this.selectedStepIndex==this.selectedGoal.stepsSize-1?this.selectedStepIndex>=1?(this.selectedStep=this.selectedGoal.steps[this.selectedStepIndex-1],this.selectedStep.label+="12345",this.selectedGoal.steps.splice(this.selectedStepIndex,1),this.selectedGoal.stepsSize--,this.selectedStepIndex--,this.processing=!0,this.findMatchingInput().then(t=>{t&&(t.focus(),this.selectedStep.label=this.selectedStep.label.slice(0,-5),this.processing=!1,this.saveUnscheduledGoals())})):(this.selectedGoal.stepsEnabled=!1,this.selectedGoal.steps.splice(this.selectedStepIndex,1),this.selectedGoal.stepsSize--,this.saveUnscheduledGoals()):(this.selectedGoal.steps.splice(this.selectedStepIndex,1),this.selectedGoal.stepsSize--,this.selectedStep=this.selectedGoal.steps[this.selectedStepIndex],this.selectedGoal.stepsSize==0&&(this.selectedGoal.stepsEnabled=!1,this.selectedStep=null),this.saveUnscheduledGoals())}}},addSteps(e,t){e.stepsSize<20&&(e.stepsSize++,t?(e.steps.splice(t,0,{label:"",value:!1}),this.selectedStep=e.steps[t],this.selectedStep.label="new step"):(e.steps.push({label:"",value:!1}),this.selectedStep=e.steps[e.stepsSize-1]),this.saveUnscheduledGoals())},removeSteps(e){e.stepsSize<=0||(e.steps.splice(e.stepsSize-1,1),e.stepsSize--,e.stepsSize==0&&(e.stepsEnabled=!1,this.selectedStep=null),this.saveUnscheduledGoals())},removeUnscheduledGoal(e){var t='Are you sure you want to delete the goal: "'+e.goal+'"?';e.goal.length<1&&(t="Are you sure you want to delete the unnamed goal?"),this.$q.dialog({title:"Confirm",message:t,cancel:!0,persistent:!0}).onOk(()=>{e.goal.length<1?this.$q.notify("Goal deleted"):this.$q.notify('Goal deleted: "'+e.goal+'"'),this.goalsStore.removeUnscheduledGoal(e.id)})},getDate(){const e=Date().toString();return G.formatDate(e,"MMM D, YYYY")},getDateWithTime(){const e=Date().toString();return G.formatDate(e,"MMM D, YYYY, hh:mm A")},getTime(){return new Date().getTime()},displayAlertTime(e){const t=new Date;return t.setHours(parseInt(e.split(":")[0],10)),t.setMinutes(parseInt(e.split(":")[1],10)),t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0})},openDatePicker(e){e.changeDateDialog=!0},closeDatePicker(e){e.date=G.formatDate(e.date,"MMM D, YYYY"),e.changeDateDialog=!1,this.$q.notify("Goal added to schedule!"),this.goalsStore.addGoal(e),this.goalsStore.removeUnscheduledGoal(e.id),this.goalsStore.sortGoals(this.settingsStore.getGoalsSortStyle()),this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle())},cancelDatePicker(e){e.changeDateDialog=!1,this.goalsStore.saveUnscheduledGoals()}}}),X={class:"q-gutter-md row justify-center top-button-group"},Z={class:"goal-data"},I={class:"text-h6"},x={class:"difficulty-select"},ee={key:0},te=n("br",null,null,-1),se={class:"steps_container"},le={key:1},oe={"q-pa-lg":"",class:"text-black"},ae={class:"row items-center justify-end"},ie=n("span",{style:{"margin-left":"0.5em"}},"Schedule Goal",-1),ne={key:2,class:"alert-data"},re={key:0,"q-pa-lg":"",class:"text-black"},de=n("br",null,null,-1),ue={class:"row items-center justify-center"};function ce(e,t,a,S,h,he){return u(),v(L,{"items-center":"",class:"unscheduled-goal-page"},{default:i(()=>[n("div",X,[o(V,{"no-wrap":""},{default:i(()=>[o(r,{class:d([e.buttonClass,"top-button"]),onClick:t[0]||(t[0]=s=>this.goalsStore.addUnscheduledGoal(null,this.settingsStore.getGoalsSortStyle())),style:{"margin-left":"0.5rem"}},{default:i(()=>[f("New Goal")]),_:1},8,["class"]),o(r,{class:d([e.buttonClass,"top-button"]),onClick:t[1]||(t[1]=s=>this.toggleGoalsSortStyle()),style:{"margin-left":"1rem","margin-right":"0.5rem"}},{default:i(()=>[f(g(e.buttonText),1)]),_:1},8,["class"]),o(r,{class:d([e.buttonClass,"top-button"]),onClick:t[2]||(t[2]=s=>this.viewGoals()),style:{"margin-left":"0.5rem","margin-right":"0.5rem"}},{default:i(()=>[f("Scheduled")]),_:1},8,["class"])]),_:1})]),o(F,null,{default:i(()=>[(u(!0),p(C,null,k(this.goalsStore.unscheduledGoals,s=>U((u(),v(N,{key:s},{default:i(()=>[o(_,{class:"goal-card text-white full-width"},{default:i(()=>[o(q,null,{default:i(()=>[n("div",Z,[n("div",I,[o($,{multiline:"",autogrow:"",wrap:"on","min-rows":1,"max-rows":10,standout:"bg-primary text-black",class:"full-width text-h6","input-class":"text-left",label:"Goal Title",modelValue:s.goal,"onUpdate:modelValue":[l=>s.goal=l,t[3]||(t[3]=l=>this.goalsStore.saveUnscheduledGoals())],onFocus:t[4]||(t[4]=l=>this.$q.notify("Goal will be saved once you enter a title")),onBlur:l=>{s.goal=s.goal.trim(),this.goalsStore.saveUnscheduledGoals()}},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),n("div",x,[o(y,{"keep-color":"",modelValue:s.difficulty,"onUpdate:modelValue":[l=>s.difficulty=l,t[5]||(t[5]=l=>this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle()))],val:"Easy",label:"Easy",color:"green"},null,8,["modelValue","onUpdate:modelValue"]),o(y,{"keep-color":"",modelValue:s.difficulty,"onUpdate:modelValue":[l=>s.difficulty=l,t[6]||(t[6]=l=>this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle()))],val:"Moderate",label:"Moderate",color:"orange"},null,8,["modelValue","onUpdate:modelValue"]),o(y,{"keep-color":"",modelValue:s.difficulty,"onUpdate:modelValue":[l=>s.difficulty=l,t[7]||(t[7]=l=>this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle()))],val:"Hard",label:"Hard",color:"red"},null,8,["modelValue","onUpdate:modelValue"]),o(y,{"keep-color":"",modelValue:s.difficulty,"onUpdate:modelValue":[l=>s.difficulty=l,t[8]||(t[8]=l=>this.goalsStore.sortUnscheduledGoals(this.settingsStore.getGoalsSortStyle()))],val:"Epic",label:"Epic",color:"black"},null,8,["modelValue","onUpdate:modelValue"])]),s.stepsEnabled?(u(),p("div",ee,[n("p",null,[f(" Base Reward: "+g(this.goalsStore.baseReward(s))+" coins.",1),te]),n("div",se,[(u(!0),p(C,null,k(s.steps,(l,m)=>(u(),p("div",{key:m,class:"steps_checkboxes"},[n("div",{class:d(e.buttonClass)},[o(E,{modelValue:l.value,"onUpdate:modelValue":[c=>l.value=c,t[9]||(t[9]=c=>this.saveUnscheduledGoals())]},null,8,["modelValue","onUpdate:modelValue"])],2),o($,{ref_for:!0,ref:"stepDescRef",multiline:"",autogrow:"",wrap:"on","min-rows":1,"max-rows":10,standout:"bg-primary text-black",class:"steps-label","input-class":"text-left",modelValue:l.label,"onUpdate:modelValue":c=>l.label=c,onKeydown:e.handleStepInput,onFocus:c=>{this.selectedGoal=s,this.selectedStep=l,this.selectedStepIndex=m},onBlur:c=>{l.label=l.label.trim(),this.goalsStore.saveUnscheduledGoals()}},null,8,["modelValue","onUpdate:modelValue","onKeydown","onFocus","onBlur"]),this.settingsStore.useStepMgmtButtons?(u(),v(V,{key:0,class:"step_management"},{default:i(()=>[o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"arrow_upward",color:"yellow",onClick:c=>e.moveStep(s,m,-1)},null,8,["class","onClick"]),o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"arrow_downward",color:"yellow",onClick:c=>e.moveStep(s,m,1)},null,8,["class","onClick"]),o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"delete",color:"red",onClick:c=>e.removeStep(s,m)},null,8,["class","onClick"])]),_:2},1024)):b("",!0)]))),128))])])):(u(),p("div",le,[n("p",oe," Reward for completion: "+g(this.goalsStore.goalReward(s))+" coins. ",1)])),n("div",{class:d(["text-goal",{overdue:this.goalsStore.goalExpired(s)}])},[o(r,{flat:"",glossy:"",color:"green",icon:"event",class:d(e.buttonClass),onClick:l=>e.openDatePicker(s),style:{"margin-top":"16px"}},{default:i(()=>[o(w,{modelValue:s.changeDateDialog,"onUpdate:modelValue":l=>s.changeDateDialog=l},{default:i(()=>[o(R,{modelValue:s.date,"onUpdate:modelValue":[l=>s.date=l,l=>e.closeDatePicker(s)]},{default:i(()=>[n("div",ae,[U(o(r,{onClick:l=>e.cancelDatePicker(s),label:"Cancel",color:"primary",flat:""},null,8,["onClick"]),[[j]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),ie]),_:2},1032,["class","onClick"])],2),this.settingsStore.useNotificationBeta?(u(),p("div",ne,[s.alertTime?(u(),p("p",re,[de,f("Alert Time: "+g(e.displayAlertTime(s.alertTime))+" day of goal. ",1)])):b("",!0),o(w,{modelValue:s.changeAlertTimeDialog,"onUpdate:modelValue":l=>s.changeAlertTimeDialog=l},{default:i(()=>[o(Y,{modelValue:s.alertTime,"onUpdate:modelValue":[l=>s.alertTime=l,t[10]||(t[10]=l=>this.saveUnscheduledGoals())],onClose:l=>e.closeAlertTimeDialog(s)},{default:i(()=>[n("div",ue,[o(r,{"float-left":"",label:"Disable",onClick:l=>this.goalsStore.disableNotification(s),color:"primary",flat:""},null,8,["onClick"]),o(r,{label:"Close",color:"primary",onClick:l=>e.closeAlertTimeDialog(s),flat:""},null,8,["onClick"])])]),_:2},1032,["modelValue","onUpdate:modelValue","onClose"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])):b("",!0)])]),_:2},1024),o(M,{dark:""}),o(P,null,{default:i(()=>[o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"check",color:"green",onClick:l=>e.completeGoal(s)},null,8,["class","onClick"]),o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"123",color:"yellow",onClick:l=>e.toggleSteps(s),style:{"margin-left":"0"}},null,8,["class","onClick"]),o(r,{class:d(e.buttonClass),flat:"",glossy:"",icon:"delete",color:"black",onClick:l=>this.removeUnscheduledGoal(s),style:{"margin-left":"0"}},null,8,["class","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[A]])),128))]),_:1})]),_:1})}var Ve=T(J,[["render",ce]]);export{Ve as default};
