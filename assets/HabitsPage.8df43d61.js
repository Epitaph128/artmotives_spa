import{c as ee,i as te,e as T,r as $,A as se,a as y,w as D,o as j,E as oe,b as V,g as ae,l as ie,_ as le,F as ne,ak as re,G as r,H as _,I as u,R as n,J as a,P as c,al as m,L as h,M as p,O as d,K as S,S as B,T as M,s as F,am as N,an as ue,ao as z,ap as U,aq as de,ar as E,as as L}from"./index.72e2c796.js";import{Q as ce}from"./QBtnGroup.b69c6302.js";import{Q as P}from"./QTime.aa351711.js";import{Q as me}from"./QCircularProgress.79c38f8f.js";import{Q as I}from"./QItem.e6aea75d.js";import{Q as O}from"./QList.726589ab.js";import{a as fe,Q as he}from"./QToolbar.058062c4.js";import{Q as ge}from"./QResizeObserver.a57a202c.js";import{Q as pe}from"./QPage.3fcf59c0.js";import{d as w}from"./date.a6efd5a0.js";import{u as ve,Q as ke}from"./QSpinnerFacebook.2ae7f491.js";import{u as be}from"./store_habits.b604b9e5.js";import{u as ye}from"./store_successes.ff3b616b.js";import{u as Y}from"./store_settings.a1abbadf.js";import"./TouchPan.b1075a9c.js";import"./selection.e44b2370.js";var Se=ee({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:o,emit:g}){const{proxy:{$q:f}}=ae(),i=te(ie,T);if(i===T)return console.error("QFooter needs to be child of QLayout"),T;const b=$(parseInt(e.heightHint,10)),t=$(!0),s=$(se.value===!0||i.isContainer.value===!0?0:window.innerHeight),H=y(()=>e.reveal===!0||i.view.value.indexOf("F")!==-1||f.platform.is.ios&&i.isContainer.value===!0),Q=y(()=>i.isContainer.value===!0?i.containerHeight.value:s.value),R=y(()=>{if(e.modelValue!==!0)return 0;if(H.value===!0)return t.value===!0?b.value:0;const l=i.scroll.value.position+Q.value+b.value-i.height.value;return l>0?l:0}),A=y(()=>e.modelValue!==!0||H.value===!0&&t.value!==!0),W=y(()=>e.modelValue===!0&&A.value===!0&&e.reveal===!0),x=y(()=>"q-footer q-layout__section--marginal "+(H.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+(A.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(H.value!==!0?" hidden":""):"")),G=y(()=>{const l=i.rows.value.bottom,v={};return l[0]==="l"&&i.left.space===!0&&(v[f.lang.rtl===!0?"right":"left"]=`${i.left.size}px`),l[2]==="r"&&i.right.space===!0&&(v[f.lang.rtl===!0?"left":"right"]=`${i.right.size}px`),v});function k(l,v){i.update("footer",l,v)}function C(l,v){l.value!==v&&(l.value=v)}function K({height:l}){C(b,l),k("size",l)}function J(){if(e.reveal!==!0)return;const{direction:l,position:v,inflectionPoint:Z}=i.scroll.value;C(t,l==="up"||v-Z<100||i.height.value-Q.value-v-b.value<300)}function X(l){W.value===!0&&C(t,!0),g("focusin",l)}D(()=>e.modelValue,l=>{k("space",l),C(t,!0),i.animate()}),D(R,l=>{k("offset",l)}),D(()=>e.reveal,l=>{l===!1&&C(t,e.modelValue)}),D(t,l=>{i.animate(),g("reveal",l)}),D([b,i.scroll,i.height],J),D(()=>f.screen.height,l=>{i.isContainer.value!==!0&&C(s,l)});const q={};return i.instances.footer=q,e.modelValue===!0&&k("size",b.value),k("space",e.modelValue),k("offset",R.value),j(()=>{i.instances.footer===q&&(i.instances.footer=void 0,k("size",0),k("offset",0),k("space",!1))}),()=>{const l=oe(o.default,[V(ge,{debounce:0,onResize:K})]);return e.elevated===!0&&l.push(V("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),V("footer",{class:x.value,style:G.value,onFocusin:X},l)}}});const Ce=ne({name:"HabitsPage",setup(){const e=ve();let o;return j(()=>{o!==void 0&&(clearTimeout(o),e.loading.hide())}),{showLoading(){e.loading.show({spinner:ke,spinnerColor:"white",spinnerSize:140,backgroundColor:"black",message:"Loading your habits... Please wait!",messageColor:"white"}),o=setTimeout(()=>{e.loading.hide(),o=void 0},500)}}},data(){return{changeDateDialog:!1,changeAlertTimeDialog:!1}},beforeMount(){this.settingsStore=Y(),this.settingsStore.initialize(),this.habitsStore=be(),this.habitsStore.initialize(),this.successesStore=ye(),this.successesStore.initialize(),this.$emit("refresh-header"),this.settingsStore.termsUpToDate()||this.$router.push("terms")},created(){this.showLoading()},computed:{...re(Y,["useBigButtons"]),buttonClass(){return this.useBigButtons?"bigBtn":""},habitCardClass(){return e=>this.habitsStore.habitNotCompleted(e)?"habit-card":"habit-card-complete"},formattedDate(){return function(e){const o=new Date(Date.parse(e));let g=w.formatDate(o,this.settingsStore.useDateFormat);return g+=", ",g+=w.formatDate(o,"h:mm A"),g}}},methods:{coinsForAllHabits(){let e=0;return this.habitsStore.habits.forEach(o=>{this.habitsStore.habitNotCompleted(o)&&(e+=this.habitsStore.habitReward(o.streak+1))}),e},completeHabit(e){if(this.habitsStore.habitNotCompleted(e)&&!e.ready){e.ready=!0,this.$q.notify("Click again to mark complete!");return}var o=this.getDateWithTime();this.habitsStore.habitNotCompleted(e)?e.habit.length===0?this.$q.notify("Please enter a title for your new habit!"):this.$q.dialog({title:"Confirm",message:'Confirm completion of habit: "'+e.habit+'"',cancel:!0,persistent:!0}).onOk(()=>{e.lastDate==null&&(e.startDate=o,new Date(e.modifiedDate)<=new Date(e.startDate)&&(e.modifiedDate=null)),this.habitsStore.streakExpired(e)&&(e.streak=0),e.lastDate=o,e.timeTieBreaker=this.getTime(),e.streak=e.streak+1;var g=this.habitsStore.habitReward(e.streak);this.$q.notify("Rewarded "+g+" coins for completion!"),this.settingsStore.coins=this.settingsStore.coins+g,this.settingsStore.totalCoins=this.settingsStore.totalCoins+g,e.total=e.total+1,e.streak>e.longestStreak&&(e.longestStreak=e.streak),this.$q.notify(e.habit+" completed for "+this.getDate()+"!");var f=!1;if((e.streak==3||e.streak==5||e.streak==7||e.streak==14||e.streak==30||e.streak==60)&&(f=!0),f){var i=Object.assign({},e);i.date=this.getDateWithTime(),i.type="habit",this.successesStore.addEntry(i),this.$q.notify("Reached milestone of "+i.streak+" days!")}this.settingsStore.saveCoins(),this.$emit("refresh-header"),this.habitsStore.sortHabits()}):this.$q.notify("Habit already complete until "+e.resetTime+"!")},removeHabit(e){e.habit&&e.habit.length>0?this.$q.dialog({title:"Confirm",message:'Are you sure you want to delete the habit: "'+e.habit+'"?',cancel:!0,persistent:!0}).onOk(()=>{this.habitsStore.removeHabit(e.id),this.$q.notify('Habit deleted: "'+e.habit+'"')}):this.$q.dialog({title:"Confirm",message:"Are you sure you want to delete the unnamed habit?",cancel:!0,persistent:!0}).onOk(()=>{this.habitsStore.removeHabit(e.id),this.$q.notify("Habit deleted")})},hideTutorial(){this.$q.dialog({title:"Acknowledge",message:"Have you read and understood the instructions?",cancel:!0,persistent:!0}).onOk(()=>{this.settingsStore.tutorialSettings.habitsTutorialHidden=!0,this.settingsStore.saveTutorialSettings()})},getDenseDisplayButtonText(){return this.settingsStore.useDenseModeHabits?"Dense Mode Active":"Dense Mode Disabled"},toggleDenseDisplay(){this.settingsStore.useDenseModeHabits||(this.settingsStore.useDenseModeHabits=!1),this.settingsStore.useDenseModeHabits=!this.settingsStore.useDenseModeHabits,this.settingsStore.saveDenseModeHabitsSetting()},getDate(){const e=Date().toString();return w.formatDate(e,"MMM D, YYYY")},getDateWithTime(){const e=Date().toString();return w.formatDate(e,"MMM D, YYYY, hh:mm A")},getTime(){return new Date().getTime()},displayAlertTime(e){const o=new Date;return o.setHours(parseInt(e.split(":")[0],10)),o.setMinutes(parseInt(e.split(":")[1],10)),o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0})},closeAlertTimeDialog(e){e.changeAlertTimeDialog=!1,this.habitsStore.saveHabits()},showResetTime(e){return e.resetTime?e.resetTime:"12:00 AM"},closeResetTimeDialog(e){e.changeResetTimeDialog=!1,this.habitsStore.saveHabits()}}}),De={class:"flex justify-center"},_e={key:0,class:"tutorial"},He=n("p",null,` Click "New Habit" to create a new Habit. You can click the Habit Reset Time (which defaults to 12:00 AM) to adjust it. This is the time the habit resets and can be completed again. If an entire cycle goes without completion, then the habit will lose its streak and have to be restarted. Larger streaks grant higher coin rewards, so stay consistent for maximum benefits! Don't worry if you lose a habit streak though! It is normal to take breaks! The purpose is to get valuable stats on your work habits. `,-1),we={class:"habit-data"},Te={class:"text-h6"},$e={class:"reset-data"},Ve=["onClick"],Qe={class:"row items-center justify-center"},Re=n("br",null,null,-1),Ae={key:0,class:"habit-started-data"},qe=n("span",{class:"bold"},"Current Streak:",-1),Be=n("span",{class:"bold"},"Longest Streak:",-1),Me=n("span",{class:"bold"},"Total completions:",-1),Fe=n("br",null,null,-1),Ne=n("span",{class:"bold"},"Started:",-1),ze={key:0},Ue=n("span",{class:"bold"},"Habit Modified:",-1),Ee=n("span",{class:"bold"},"Last completed:",-1),Le={class:"text-black",style:{"margin-bottom":"-2em"}},Pe=n("br",null,null,-1),Ie={key:1,class:"alert-data"},Oe={key:0,"q-pa-lg":"",class:"text-black"},Ye=n("br",null,null,-1),je={class:"row items-center justify-center"},We={key:0},xe={key:0},Ge={key:1},Ke={key:1},Je={key:2,class:"alert-data"},Xe={class:"habit-data"},Ze={class:"text-h6"},et=["onClick"],tt={key:0},st={key:0},ot={key:1},at={key:1};function it(e,o,g,f,i,b){return r(),_(pe,{"items-center":"",class:"habits-page"},{default:u(()=>[n("div",De,[a(ce,null,{default:u(()=>[a(c,{class:m([e.buttonClass,"top-button"]),onClick:o[0]||(o[0]=t=>this.habitsStore.addHabit())},{default:u(()=>[h("New Habit")]),_:1},8,["class"]),a(c,{class:m([e.buttonClass,"top-button"]),style:{"margin-left":"1rem","margin-right":"0.5rem"},onClick:o[1]||(o[1]=t=>this.toggleDenseDisplay())},{default:u(()=>[h(p(this.getDenseDisplayButtonText()),1)]),_:1},8,["class"])]),_:1})]),this.settingsStore.tutorialSettings.habitsTutorialHidden?S("",!0):(r(),d("div",_e,[He,a(c,{flat:"",dense:"",glossy:"",icon:"done",color:"check",onClick:o[2]||(o[2]=t=>this.hideTutorial())})])),this.settingsStore.useDenseModeHabits?(r(),_(O,{key:2},{default:u(()=>[(r(!0),d(M,null,B(this.habitsStore.habits,t=>F((r(),_(I,{key:t},{default:u(()=>[a(N,{class:m([e.habitCardClass(t),"text-white full-width"])},{default:u(()=>[n("div",Xe,[n("div",Ze,[a(z,{multiline:"",autogrow:"",wrap:"on","min-rows":1,"max-rows":10,standout:"bg-primary text-black",class:"full-width text-h6","input-class":"text-left",label:"Habit Title",modelValue:t.habit,"onUpdate:modelValue":s=>t.habit=s,onFocus:s=>{t.preEditHabit=t.habit,this.$q.notify("Habit will be saved once you enter a title")},onBlur:s=>{t.habit=t.habit.trim(),t.preEditHabit!==t.habit?(t.preEditHabit=null,t.modifiedDate=this.getDateWithTime(),this.habitsStore.saveHabits()):t.preEditHabit=null}},null,8,["modelValue","onUpdate:modelValue","onFocus","onBlur"])]),n("p",{class:m({dashed:!t.lastDate}),style:{padding:"1em 0.5em"},onClick:s=>{!t.lastDate&&!this.settingsStore.useDenseModeHabits&&(t.changeResetTimeDialog=!0)}}," Habit Resets at "+p(e.showResetTime(t)),11,et)]),a(E,null,{default:u(()=>[this.habitsStore.habitNotCompleted(t)?(r(),d("div",tt,[t.ready?(r(),d("div",st,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"done_all",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])])):(r(),d("div",ot,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"check",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])]))])):(r(),d("div",at,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"assignment_turned_in",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])])),a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"delete",color:"black",glossy:"",onClick:s=>e.removeHabit(t)},null,8,["class","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024)),[[L]])),128))]),_:1})):(r(),_(O,{key:1},{default:u(()=>[(r(!0),d(M,null,B(this.habitsStore.habits,t=>F((r(),_(I,{key:t},{default:u(()=>[a(N,{class:m([e.habitCardClass(t),"text-white full-width"])},{default:u(()=>[a(ue,null,{default:u(()=>[n("div",we,[n("div",Te,[a(z,{multiline:"",autogrow:"",wrap:"on","min-rows":1,"max-rows":10,standout:"bg-primary text-black",class:"full-width text-h6","input-class":"text-left",label:"Habit Title",modelValue:t.habit,"onUpdate:modelValue":s=>t.habit=s,onFocus:s=>{t.preEditHabit=t.habit,this.$q.notify("Habit will be saved once you enter a title")},onBlur:s=>{t.habit=t.habit.trim(),t.preEditHabit!==t.habit?(t.preEditHabit=null,t.modifiedDate=this.getDateWithTime(),this.habitsStore.saveHabits()):t.preEditHabit=null}},null,8,["modelValue","onUpdate:modelValue","onFocus","onBlur"]),n("div",$e,[n("p",{class:m({dashed:!t.lastDate}),style:{margin:"0","margin-top":"16px","padding-top":"0.5em","padding-left":"0"},onClick:s=>{t.lastDate||(t.changeResetTimeDialog=!0)}}," Habit Resets at "+p(e.showResetTime(t)),11,Ve),a(U,{modelValue:t.changeResetTimeDialog,"onUpdate:modelValue":s=>t.changeResetTimeDialog=s},{default:u(()=>[a(P,{mask:"hh:mm A",modelValue:t.resetTime,"onUpdate:modelValue":[s=>t.resetTime=s,o[3]||(o[3]=s=>this.habitsStore.saveHabits())],onClose:s=>e.closeResetTimeDialog(t)},{default:u(()=>[n("div",Qe,[a(c,{label:"Close",color:"primary",onClick:s=>e.closeResetTimeDialog(t),flat:""},null,8,["onClick"])])]),_:2},1032,["modelValue","onUpdate:modelValue","onClose"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),Re,t.startDate!=null?(r(),d("div",Ae,[n("p",null,[qe,h(" "+p(t.streak)+" days. ",1)]),n("p",null,[Be,h(" "+p(t.longestStreak)+" days. ",1)]),n("p",null,[Me,h(" "+p(t.total)+" completions. ",1)]),Fe,n("p",null,[Ne,h(" "+p(e.formattedDate(t.startDate)),1)]),t.modifiedDate?(r(),d("p",ze,[Ue,h(" "+p(e.formattedDate(t.modifiedDate)),1)])):S("",!0),n("p",null,[Ee,h(" "+p(e.formattedDate(t.lastDate)),1)])])):S("",!0),n("p",Le,[h(" Reward for completion: "),a(me,{"show-value":"",class:"text-light-blue q-ma-md",value:this.habitsStore.habitRewardPercent(t.streak+1),size:"64px",color:"light-blue"},{default:u(()=>[h(p(this.habitsStore.habitReward(t.streak+1)),1),Pe,h(" coins ")]),_:2},1032,["value"])]),this.settingsStore.useNotificationBeta?(r(),d("div",Ie,[t.alertTime?(r(),d("p",Oe,[Ye,h("Alert Time: "+p(e.displayAlertTime(t.alertTime))+" Daily ",1)])):S("",!0),a(U,{modelValue:t.changeAlertTimeDialog,"onUpdate:modelValue":s=>t.changeAlertTimeDialog=s},{default:u(()=>[a(P,{modelValue:t.alertTime,"onUpdate:modelValue":[s=>t.alertTime=s,o[4]||(o[4]=s=>this.habitsStore.saveHabits())],onClose:s=>e.closeAlertTimeDialog(t)},{default:u(()=>[n("div",je,[a(c,{"float-left":"",label:"Disable",onClick:s=>this.habitsStore.disableNotification(t),color:"primary",flat:""},null,8,["onClick"]),a(c,{label:"Close",color:"primary",onClick:s=>e.closeAlertTimeDialog(t),flat:""},null,8,["onClick"])])]),_:2},1032,["modelValue","onUpdate:modelValue","onClose"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])):S("",!0)])]),_:2},1024),a(de,{dark:""}),a(E,null,{default:u(()=>[this.habitsStore.habitNotCompleted(t)?(r(),d("div",We,[t.ready?(r(),d("div",xe,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"done_all",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])])):(r(),d("div",Ge,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"check",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])]))])):(r(),d("div",Ke,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"assignment_turned_in",color:"green",glossy:"",onClick:s=>e.completeHabit(t)},null,8,["class","onClick"])])),this.settingsStore.useNotificationBeta?(r(),d("div",Je,[a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"notifications",color:"red",glossy:"",onClick:s=>t.changeAlertTimeDialog=!0},null,8,["class","onClick"])])):S("",!0),a(c,{class:m(e.buttonClass),flat:"",dense:"",icon:"delete",color:"black",glossy:"",onClick:s=>e.removeHabit(t)},null,8,["class","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024)),[[L]])),128))]),_:1})),this.habitsStore.habits.length>0&&this.coinsForAllHabits()>0?(r(),_(Se,{key:3},{default:u(()=>[a(he,null,{default:u(()=>[a(fe,null,{default:u(()=>[h("\u2022 If you complete all incomplete habits you will receive "+p(this.coinsForAllHabits())+" coins!",1)]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1})}var Ct=le(Ce,[["render",it]]);export{Ct as default};
